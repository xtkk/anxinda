
# 安心达项目需求设计文档

本软件是给斯柯达为专属医院针对VIP患者提供预约订车服务所使用的软件，包括司机端小程序、患者端小程序、后台管理系统。


## 版本信息

版本号 | 修订日期 | 修改内容
--- | --- | ---
1.0 | 2019-06-11 | 1.0版功能需求文档
1.1 | 2019-06-12 | update: 司机端修改为线下模式，通过短信触发关键事件
1.2 | 2019-06-24 | update: 增加注册功能，预约信息填写分成2步


## 本软件(v1.0)不包含的功能

- 线上支付
- 司机端小程序(通过短信或人工沟通)


## 患者端小程序功能模块详细描述

### 注册和登录模块
两种方式注册:<br>
1. 直接微信授权获取手机号快速注册
2. 用户手动输入`手机号+验证码`注册
类似`便利蜂`的做法<br>
同时采用`登录即注册`的模式，也就是说，如果登录的手机号不存在，则自动进行注册，不对登录和注册进行区分


### 首页
首页主要包含一个地图模块，提供上车地点与下车地点的选择功能，
下面有2个输入框和一个按钮，可手动输入地址

功能点说明：
1. 地图组件，可放大缩小，默认以用户当前所在位置为中心，并且可以让用户移动地点和手动搜索两种形式选择
2. 医院地址固定，不可修改
3. 提供快速切换起点与终点的按钮
4. 点击按钮，跳转到预约信息填写页面

### 预约信息填写页面
该页面主要是填写预约时间和乘车人信息等

功能点说明：
1. 乘车日期为4小时后的时间
2. 乘车人姓名
3. 乘车人电话
4. 增值服务列表(可多选)
5. 可用车辆数，由后台调度系统决定，如果为0，则不可进行下一步。
6. 订单费用，具体算法见[附录1-价格算法](#附录1)


### 更多信息填写页面
1. 显示上一步已填写的信息(姓名、手机号、预约时间)
2. 显示里程数并用地图绘制行程路径
3. 备注信息填写框
4. 订单价格提示
5. 点击“确认行程”按钮，生成行程单并跳转到行程单详情页面(此时，该订单为`预约中`状态)，由后台系统为该订单调度车辆。


### 行程单详情页面
该页面主要显示行程信息，包括乘车人信息，车辆信息，订单信息

订单信息包括：订单号、订单状态、订单价格、订单生成时间、预约成功时间、订单结束时间和订单距离等<br>
> 订单状态见[附录2中的用户端订单状态](#用户端显示的订单状态)<br>
> 关于时间：有则显示，没有则不显示<br>

如果为预约成功，则同时显示车辆信息<br>
如果为预约失败，则显示失败原因，比如无可用车辆等<br>
预约成功之后，状态随司机的动作而进行变化

车辆信息包括：司机姓名、电话、车牌号码和型号颜色等

### 行程列表页面
显示该订车人下的所有订单<br>
每个订单要显示的内容：<br>
订单号、订单状态、订单预约时间、上车地点、医院名称<br>
订单状态见[附录2中的用户端订单状态](#用户端显示的订单状态)<br>

### 客服静态页面


## 司机端流程

1. 接收客服的通知短信，得知乘客姓名、手机号、预约时间、上车地点等信息(预约中 -> 预约成功)
2. 到达预定时间，司机通知客服开始服务
3. 客服更新订单状态(预约成功 -> 服务中)并触发短信，告知乘客等待司机到达
4. 司机到达乘客位置并将之送至目的地
5. 乘客支付费用并开始就医
6. 司机通知客服订单完成
7. 客服更新订单状态，订单结束(服务中 -> 服务完结)


## 后台管理系统功能模块详细描述

### 司机管理
列出所有司机信息，包括姓名、电话、当天是否打卡

### 车辆管理
列出所有可用车辆，包括车牌号码、颜色、车型等等

### 待调度订单列表
显示所有预约中的订单

### 调度页面
该页面为指定的订单进行调度，可为该订单分配司机和车辆，分配之后该订单即进入“预约成功”状态<br>
如果可用司机或车辆为0，则可以修改该订单为“预约失败”<br>
<del>司机默认每单需要3个小时服务，也就是说，同一个司机可以接受预约时间间隔在3个小时以上的订单<del><br>
根据订单的预计到达时间进行司机调度<br>


### 订单列表页面
显示所有的订单，顶部的筛选条件可以提供不同的筛选条件，包括已完成订单、进行中订单、待预约订单等<br>


## 附录1
### 价格算法：

> 以下数值仅为演示

订单价格由`预约费`、`起步价`、`里程费`、`增值服务费`构成

里程费按照里程数区间进行计价：

里程区间(单位:公里)|价格(单位:元)
---|---
0 ~ 10 | 30
10 ~ 20 | 50
20 ~ 30 | 80


## 附录2

### 用户端显示的订单状态
状态 | 备注
--- | ---
预约中 | 等待后台调度
预约成功 | 调度成功且司机未出发
预约失败 | 无司机或车辆
服务中 | 预约成功且司机已出发
服务完结 | 司机已送至目的地且已收款成功
服务取消 | 预约时间前2小时可以取消